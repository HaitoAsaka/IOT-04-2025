<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./Dashboard.css" />
    <title>Document</title>
  </head>



  <body>
    <div class="sidebar">
      <div class="header">
        <div class="logo-container">
            <div class="logo">
                <img src="./img/ptit.png" alt="Logo">
            </div>
            <div class="title">Quản lý dữ liệu cảm biến</div>
        </div>
    </div>
    
      <div class="menu-item">
          <img class="icon" src="./img/dashboard.png" alt="Dashboard">
          <a href="#">Dashboard</a>
      </div>
      <div class="menu-item">
          <img class="icon" src="./img/data.png" alt="Dữ liệu cảm biến">
          <a href="Data.html">Dữ liệu cảm biến</a>
      </div>
      <div class="menu-item">
          <img class="icon" src="./img/history.png" alt="Lịch sử bật tắt">
          <a href="History.html">Lịch sử bật tắt</a>
      </div>
      <div class="menu-item">
          <img class="icon" src="./img/profile.jpg" alt="Profile">
          <a href="Profile.html">Profile</a>
      </div>
  </div>
  <div class="content">
    <div class="sections">
      <section class="sensor-box">
        <div class="sensor-bg"></div>
        <h2 class="sensor-title">Nhiệt độ</h2>
      
        <div class="sensor-value">
          <p class="sensor-number">30</p>
          <span class="sensor-unit">℃</span>
        </div>
      
        <div class="sensor-icon">
          <div class="sensor-circle"></div>
          <img src="./img/heat.png" alt="Nhiệt độ">
        </div>
      
        <p class="sensor-status status-high">Cao</p>
        <img class="sensor-bg-img" src="./img/Frame 34.png">
      </section>
      
      <section class="sensor-box">
        <div class="sensor-bg"></div>
        <h2 class="sensor-title">Độ ẩm</h2>
      
        <div class="sensor-value">
          <p class="sensor-number">63</p>
          <span class="sensor-unit">%</span>
        </div>
      
        <div class="sensor-icon">
          <div class="sensor-circle"></div>
          <img src="./img/Humidity.png" alt="Độ ẩm">
        </div>
      
        <p class="sensor-status status-medium">Vừa</p>
        <img class="sensor-bg-img" src="./img/Group 30.png">
      </section>
      
      <section class="sensor-box">
        <div class="sensor-bg"></div>
        <h2 class="sensor-title">Ánh sáng</h2>
      
        <div class="sensor-value">
          <p class="sensor-number">600</p>
          <span class="sensor-unit">Lux</span>
        </div>
      
        <div class="sensor-icon">
          <div class="sensor-circle"></div>
          <img src="./img/Light.png" alt="Ánh sáng">
        </div>
      
        <p class="sensor-status status-high">Cao</p>
        <img class="sensor-bg-img" src="./img/Group 11.png">
      </section>
  </div>

  <div class="container">
    <section class="chart-section">
            <div class="bi-u-gi-tr-th-c">Biểu đồ giá trị thực</div>

        <div class="chart-group">
            <div class="chart-container">
            <canvas id="temperatureChart"></canvas>
            <div class="chart-legend">Biểu đồ nhiệt độ (℃)</div>
            </div>

            <div class="chart-container">
            <canvas id="humidityChart"></canvas>
            <div class="chart-legend">Biểu đồ độ ẩm (%)</div>
            </div>

            <div class="chart-container">
            <canvas id="lightChart"></canvas>
            <div class="chart-legend">Biểu đồ ánh sáng (Lux)</div>
            </div>
  </div>
    </section>

    <section class="device-control">
      <!-- Điều hòa -->
      <div class="device">
          <div class="device-info">
              <div class="device-icon">
                  <img src="./img/dh.png" alt="Điều hòa">
              </div>
              <h3 class="device-name">Đèn 1</h3>
          </div>
          <div class="button-container">
              <button class="button button2" onclick="toggleButton(this)">Bật</button>
              <button class="button button4" onclick="toggleButton(this)">Tắt</button>
          </div>
      </div>
  
      <!-- Đèn ngủ -->
      <div class="device">
          <div class="device-info">
              <div class="device-icon">
                  <img src="./img/dn.png" alt="Đèn ngủ">
              </div>
              <h3 class="device-name">Đèn 2</h3>
          </div>
          <div class="button-container">
              <button class="button button2" onclick="toggleButton(this)">Bật</button>
              <button class="button button4" onclick="toggleButton(this)">Tắt</button>
          </div>
      </div>
  
      <!-- Quạt trần -->
      <div class="device">
          <div class="device-info">
              <div class="device-icon">
                  <img src="./img/qt.png" alt="Quạt trần">
              </div>
              <h3 class="device-name">Đèn 3</h3>
          </div>
          <div class="button-container">
              <button class="button button2" onclick="toggleButton(this)">Bật</button>
              <button class="button button4" onclick="toggleButton(this)">Tắt</button>
          </div>
      </div>
  </section>
  
  
  
  
</div>

 
  </body>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function toggleButton(button) {
    let container = button.parentElement;
    let buttons = container.getElementsByTagName("button");

    for (let btn of buttons) {
        btn.classList.remove("active");
        btn.style.backgroundColor = "";
    }

    button.classList.add("active");

    if (button.textContent.trim() === "Bật") {
        button.style.backgroundColor = "#4CAF50";
    } else {
        button.style.backgroundColor = "#F44336";
    }
}

document.addEventListener("DOMContentLoaded", function () {
    // ========================== BIỂU ĐỒ CHART.JS TÁCH RIÊNG ==========================

    function createChart(canvasId, label, data, color, labels) {
        const ctx = document.getElementById(canvasId).getContext("2d");
        new Chart(ctx, {
            type: "bar",
            data: {
                labels: labels,
                datasets: [{
                    label: label,
                    data: data,
                    backgroundColor: color,
                    borderColor: color,
                    borderWidth: 1,
                }],
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        ticks: {
                            display: false  // Ẩn nhãn trên trục x
                        },
                        grid: {
                            drawTicks: false,   // Ẩn các dấu tick nhỏ trên trục x
                            drawOnChartArea: false // Ẩn lưới trục x nếu muốn
                        }
                    },
                    y: {
                        beginAtZero: true,
                    }
                },
                plugins: {
                    tooltip: { enabled: true },
                    legend: { display: false },
                    //legend: { display: true, position: 'top' },
                }
            },
            plugins: [{
                afterDatasetsDraw: function (chart) {
                    const ctx = chart.ctx;
                    chart.data.datasets.forEach((dataset, i) => {
                        const meta = chart.getDatasetMeta(i);
                        if (!meta.hidden) {
                            meta.data.forEach((element, index) => {
                                const data = dataset.data[index];
                                ctx.fillStyle = '#000';
                                ctx.font = 'bold 12px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText(data, element.x, element.y - 5);
                            });
                        }
                    });
                }
            }]
        });
    }

    // Fetch dữ liệu từ API
    fetch("http://localhost:5000/api/chart-data")
        .then(response => response.json())
        .then(data => {
            const labels = data.labels;
            const tempData = data.temperature;
            const humidData = data.humidity;
            const lightData = data.light;

            createChart('temperatureChart', 'Nhiệt độ (℃)', tempData, 'rgba(255, 0, 0, 0.6)', labels);
            createChart('humidityChart', 'Độ ẩm (%)', humidData, 'rgba(0, 0, 255, 0.6)', labels);
            createChart('lightChart', 'Ánh sáng (Lux)', lightData, 'rgba(255, 255, 0, 0.6)', labels);
        })
        .catch(error => console.error("Lỗi khi tải dữ liệu biểu đồ:", error));
});
</script>
<script>
  function updateSensorValues(data) {
    // Cập nhật giá trị số
    document.querySelectorAll(".sensor-number")[0].textContent = data.temperature;
    document.querySelectorAll(".sensor-number")[1].textContent = data.humidity;
    document.querySelectorAll(".sensor-number")[2].textContent = data.light;

    // Cập nhật trạng thái (ví dụ đơn giản)
    document.querySelectorAll(".sensor-status")[0].textContent =
      data.temperature > 35 ? "Cao" : data.temperature >= 28 ? "Vừa" : "Thấp";

    document.querySelectorAll(".sensor-status")[1].textContent =
      data.humidity > 70 ? "Cao" : data.humidity >= 50 ? "Vừa" : "Thấp";

    document.querySelectorAll(".sensor-status")[2].textContent =
      data.light > 100 ? "Cao" : data.light >= 80 ? "Vừa" : "Thấp";
  }

  fetch("http://localhost:5000/api/latest-sensor")
    .then(response => response.json())
    .then(data => updateSensorValues(data))
    .catch(error => console.error("Lỗi khi tải dữ liệu cảm biến:", error));

  // Nếu muốn tự động cập nhật mỗi 2 giây, có thể dùng:
  setInterval(() => {
    fetch("http://localhost:5000/api/latest-sensor")
      .then(response => response.json())
      .then(data => updateSensorValues(data));
  }, 2000);
</script>


</html>
